---
title: "Outline Wayne"
output: html_document
date: "2025-03-25"
---


## Outline

Data cleaning
  Making dummy variables

Exploratory Analysis
  Check for missing vals
  Summary stats

Model Training
  Cross Validation
  GAM
  MARS
  Linear Regression
  Elastic Net
  Select via cross validated RMSE?
  Look at the plots!
  
Model Evaluation
  RMSE
  Distribution of residuals
  Compare the summary statistics between the two samples. 
  


# Project

## Data Cleaning

```{r}
library(caret)
library(tidymodels)
library(splines)
library(mgcv)
library(pdp)
library(earth)
library(tidyverse)
library(ggplot2)
library(glmnet)
```


Making dummy variables
```{r}
load('dat1.RData')
```


```{r}
design_matrix = 
  dat1 |>
  mutate(
    race_asian = as.numeric(race == 2),
    race_black = as.numeric(race == 3),
    race_hispanic = as.numeric(race == 4),
    smoking_former = as.numeric(smoking == 1),
    smoking_current = as.numeric(smoking ==2)
  ) %>% 
  select(
    age, gender, race_asian, race_black, race_hispanic, 
    smoking_former, smoking_current, height, weight,
    bmi, diabetes, hypertension, SBP, LDL, time, 
    log_antibody
  )
```


## Model Training

Cross Validation
  GAM
  MARS
  Linear Regression
  Elastic Net
  Select via cross validated RMSE?
  Look at the plots!
  
  
Linear Regression
```{r}
linear_regression =
  lm(log_antibody ~ .,
     data = design_matrix)

summary(linear_regression)
```


Elastic Net
```{r}
set.seed(1)
model.elastic_net =
  train(x = x,
        y = y,
        method = "glmnet", 
        metric = "RMSE",
        trControl = ctrl)

model.elastic_net$finalModel


hist(model.elastic_net$results$RMSE)
```


Elastic Net
```{r}
y = design_matrix$log_antibody
x = 
  select(design_matrix, -log_antibody) %>% 
  as.matrix()

cvfit <- cv.glmnet(x, y)
```

```{r}
# histogram of cross validated error
hist(cvfit$cvm)
```


GAM
```{r}
# train a GAM model using caret
## CITE FROM LECTURE

# set up cross validation control
ctrl <- trainControl(method = "cv", number = 3)

set.seed(1)
model.gam =
  train(x = x,
        y = y,
        method = "gam", 
        metric = "RMSE",
        trControl = ctrl)

model.gam$finalModel
```



MARS
```{r}
mars_grid = 
  expand.grid(degree = 1:3,
              nprune = 2:15)

set.seed(2)
mars.fit = 
  train(x, y,
        method = "earth",
        tuneGrid = mars_grid,
        trControl = ctrl)

ggplot(mars.fit)
```



## Comparing Cross Validated RMSE

```{r}

```

